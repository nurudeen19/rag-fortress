name: Add new issues to project board

on:
  issues:
    types: [opened]

jobs:
  add-to-project:
    runs-on: ubuntu-latest
    steps:
      - name: Add issue to project column
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PROJECT_COLUMN_ID: ${{ secrets.PROJECT_COLUMN_ID }}
        run: |
          if [ -z "$PROJECT_COLUMN_ID" ]; then
            echo "Set PROJECT_COLUMN_ID as a secret in repo settings."
            exit 0
          fi

          ISSUE_ID=${{ github.event.issue.id }}
          curl -s -X POST \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/projects/columns/$PROJECT_COLUMN_ID/cards \
            -d "{\"content_id\": $ISSUE_ID, \"content_type\": \"Issue\"}"
